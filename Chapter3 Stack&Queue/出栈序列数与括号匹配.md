#  出栈序列数与括号匹配（卡特兰数的应用）

[文章详见](https://blog.csdn.net/Sintream_ouse/article/details/151358847?spm=1001.2014.3001.5501)

### 1.问题描述

####  n个不同元素按 a~1~ , a~2~ , ...... , a~n-1~ , a~n~ 顺序入栈，求出栈序列的种类总数。

#### 例如三个元素，数字 1 , 2 , 3 顺序入栈，可以产生的出栈序列：

* 3 , 2 , 1 ; (一次性全部入栈后全部出栈)
* 1 , 2 , 3 ; (进去一个就马上出来)
* 1 , 3 , 2 ; (1第一个入栈再立马出栈，2和3一次性入栈，再弹出)
* 2 , 1 , 3 ;
* 2 , 3 , 1 ;

#### **出栈依据LIFO规则** 。



### 2.转化为括号问题

####	**每个入栈可以看作一个左括号“ (”，每个出栈看作一个右括号“ )”，要求是：**

* 一共 n 个入栈，n 个出栈 → 总共有 2n 个括号。

* 在任何前缀里，入栈数 ≥ 出栈数（否则栈就空了却还要出栈，不合法）。

#### **这正好就是 括号匹配问题 → 数量是第 n 个卡特兰数 。**



### 3. 卡特兰数公式

#### **第n个卡特兰数（通项公式）：**

$$
C_n = \frac{1}{n + 1}\binom{2n}{n}
$$
#### **递推关系式：**

$$
C_{n+1} = \sum_{i=0}^nC_iC_{n-i}
$$



### 4.计数括号匹配序列数

#### **合法括号序列：长度为 $2n$，满足：**

* 左括号数 = 右括号数 = $n$；
* 从左往右扫描时，任何前缀里，左括号数 ≥ 右括号数。

#### **解法思路**

1. 总共有$\binom{2n}{n}$种方式从 $2n$ 个位置里放置 $n$ 个左括号；
2. 其中一部分会出现“前缀右括号多于左括号”，这是非法的；
3. 用“反射原理”可以排除非法情况。



### 5.“反射原理”求卡特兰数

#### 依据数形结合的思想，构造巧妙地映射求解通项公式

​	构造平面坐标$xOy$, 从$(0 , 0)$到$(n , n)$一共需要$n$次向右$n$次向上，一共$2n$步，$C_{2n}^n$种情况。所有情况中，有穿过直线$y = x$的路线，即向上多于向右的路线（等价于存在前缀右括号多于左括号的非法括号匹配情况），

#### 分析穿过$y = x$的路线

​	考虑非法路径集合中的一条，假设其从起点出发后第一次跨越对角线到C点，过C点作对角线的平行线，以该线为对称轴，将C点和终点B之间的的路径对称，效果如图。

<img style="width:400px;" src="https://s21.ax1x.com/2025/09/09/pVRmd8s.jpg">

​	B点的对称点为B^'^,镜像对称操作后，原本由A点到B点的路径，转化成A到新终点B^'^的路径，同理，非法路径集合的每一条都能如此转化 （可以尝试举几个例子，新终点一定为B^'^）。因此，求A到B的非法路径数，转化为求A到B^'^的所有路径数，易知此时需要完成2n次位移操作，其中向右次数为n-1，向上次数为n+1，一共$C_{2n}^{n-1}$种情况。
$$
合法路径数=所有路径数-非法路径数
$$

$$
C_n=C_{2n}^{n}-C_{2n}^{n-1}=\frac{1}{n+1}\binom{2n}{n}
$$



### 6.总结

#### **此时求出的$C_n$的所有含义：**

* A到B的合法路径数；
* 2n个括号的合法匹配种类数；
* 第n个卡特兰数；
* 2n个不同元素（顺序入栈）的出栈序列数。


















​	










